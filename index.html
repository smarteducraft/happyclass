<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <title>Happy Class (V3.56)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Black+Han+Sans&family=Dongle:wght@400;700&family=Gowun+Batang:wght@400;700&family=Jua&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent-color: #6366f1;
        }
        body {
            font-family: "Pretendard Variable", Pretendard, sans-serif;
            transition: background 0.5s ease, color 0.5s ease;
            min-height: 100dvh;
            overflow-y: auto; /* ì „ì²´ ìŠ¤í¬ë¡¤ í—ˆìš© */
            background-attachment: fixed;
        }
        .glass {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .text-shadow-lg { text-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.1); }
        .text-shadow-strong { text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        
        #bg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-size: cover; background-position: center;
            transition: all 0.8s ease;
        }

        /* Responsive Layout & Scrolling */
        .main-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-height: 100dvh;
            margin: 0 auto;
        }

        /* íƒœë¸”ë¦¿ ì´ìƒì˜ ê°€ë¡œ í™”ë©´ (ë°ìŠ¤í¬í†± í¬í•¨) */
        @media (min-width: 1024px) {
            .main-container {
                flex-direction: row;
                height: 100vh;
                overflow: hidden;
            }
            #left-panel {
                width: 35%; 
                height: 100%; 
                overflow-y: auto;
                padding-right: 1.5rem;
            }
            #right-panel {
                width: 65%; 
                height: 100%; 
                overflow: hidden;
            }
        }

        /* ëª¨ë°”ì¼ ë° ì„¸ë¡œí˜• íƒœë¸”ë¦¿ */
        @media (max-width: 1023px) {
            #left-panel {
                width: 100%;
                padding: 1.5rem 1rem;
                text-align: center;
            }
            #right-panel {
                width: 100%;
                padding: 1rem;
                min-height: 60dvh;
            }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        
        .editable-input { background: transparent; border: none; outline: none; width: 100%; padding: 2px 0; }
        .editable-input:focus { background: rgba(255,255,255,0.3); border-radius: 4px; }
        
        #notice-textarea { 
            background: transparent; border: none; outline: none; resize: none; 
            width: 100%; height: 100%; font-size: 1.25rem; line-height: 1.5; 
            font-weight: 700; min-height: 250px;
        }
        @media (min-width: 1024px) { #notice-textarea { font-size: 2.2rem; } }

        #album-image { transition: opacity 0.8s ease-in-out; opacity: 1; }
        .fade-out { opacity: 0 !important; }

        .loader { 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid var(--accent-color); 
            border-radius: 50%; 
            width: 30px; height: 30px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .dynamic-accent-text { color: var(--accent-color) !important; }
        .dynamic-accent-bg { background-color: var(--accent-color) !important; }
        
        .btn-active { color: var(--accent-color) !important; background: rgba(255, 255, 255, 0.4); border-radius: 50%; }
        
        .color-circle {
            width: 34px; height: 34px; border-radius: 50%; cursor: pointer;
            border: 2px solid white; transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
        }
        @media (min-width: 768px) { .color-circle { width: 40px; height: 40px; } }
        .color-circle:hover { transform: translateY(-2px) scale(1.1); }
        .color-circle.selected { border-color: var(--accent-color); transform: scale(1.15); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }

        .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ ë°” ê°€ë…ì„± ê°œì„  */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-800">
    <div id="bg-container"></div>

    <main class="main-container p-3 md:p-6 lg:p-8 z-10">
        <!-- ì¢Œì¸¡ ì˜ì—­ (ì‹œê³„ ë° ìƒíƒœ) -->
        <section id="left-panel" class="flex flex-col justify-between py-4 lg:py-6 px-4 text-shadow-lg transition-all custom-scrollbar">
            <div class="flex flex-col items-center lg:items-start gap-4 lg:gap-12">
                <!-- íƒ€ì´í‹€ -->
                <h1 id="left-panel-title" class="font-black tracking-tighter text-shadow-strong break-keep leading-tight text-3xl md:text-5xl lg:text-6xl xl:text-7xl">Happy Class</h1>
                
                <!-- ë‚ ì§œ ë° ìš”ì¼ -->
                <div class="space-y-1 lg:space-y-2 text-center lg:text-left">
                    <div id="date-display" class="text-lg md:text-2xl lg:text-3xl font-bold tracking-tight opacity-90">0000. 00. 00</div>
                    <div id="day-display" class="text-3xl md:text-5xl lg:text-6xl font-black dynamic-accent-text">ìš”ì¼</div>
                </div>
            </div>

            <!-- ì‹œê³„ ë¶€ë¶„ -->
            <div class="flex flex-col gap-0 mt-6 lg:mt-0 items-center lg:items-start">
                <div class="flex flex-col items-center lg:items-start">
                    <span id="ampm-display" class="text-xl md:text-3xl lg:text-4xl font-bold mb-1 dynamic-accent-text">--</span>
                    <div class="flex items-baseline">
                        <span id="time-display" class="text-5xl md:text-8xl lg:text-[7rem] xl:text-[8.5rem] font-black leading-none tracking-tighter text-shadow-strong">00:00</span>
                        <span class="text-xl md:text-3xl lg:text-4xl font-bold opacity-50 ml-2 md:ml-4">: <span id="sec-display">00</span></span>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ ìƒíƒœ ì •ë³´ -->
            <div class="space-y-3 flex flex-col items-center lg:items-start mt-6 lg:mt-0">
                <div id="status-badge" class="glass inline-block px-5 lg:px-8 py-2.5 lg:py-4 rounded-2xl lg:rounded-3xl text-lg lg:text-3xl font-black shadow-xl border-white/50 mb-2">ìƒíƒœ ë¡œë”©ì¤‘</div>
                <div id="dday-container" class="flex flex-wrap justify-center lg:justify-start gap-2 max-w-full"></div>
            </div>
        </section>

        <!-- ìš°ì¸¡ ì˜ì—­ (ëŒ€ì‹œë³´ë“œ ì½˜í…ì¸ ) -->
        <section id="right-panel" class="flex flex-col p-2 lg:p-4">
            <div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-4 lg:mb-8 gap-4">
                <div class="flex flex-col md:flex-row items-center md:items-end gap-4 w-full md:w-auto">
                    <div class="text-center md:text-left hidden lg:block">
                        <h2 id="right-title" class="text-3xl lg:text-5xl font-black dynamic-accent-text mb-1 text-shadow-lg whitespace-nowrap">Dashboard</h2>
                        <p id="right-subtitle" class="text-xs lg:text-lg font-bold tracking-widest opacity-70 uppercase">Smart Classroom</p>
                    </div>
                    <!-- íƒ­ ì „í™˜ ë²„íŠ¼ -->
                    <div class="flex bg-white/20 p-1 rounded-2xl backdrop-blur-sm border border-white/20 overflow-x-auto custom-scrollbar w-full md:w-auto scrollbar-hide">
                        <button onclick="toggleView('rules')" id="btn-view-rules" class="flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm whitespace-nowrap">ì•½ì†</button>
                        <button onclick="toggleView('notice')" id="btn-view-notice" class="flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm whitespace-nowrap">ì•Œë¦¼ì¥</button>
                        <button onclick="toggleView('announcements')" id="btn-view-announcements" class="flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm whitespace-nowrap">ê³µì§€</button>
                        <button onclick="toggleView('meal')" id="btn-view-meal" class="flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm whitespace-nowrap">ê¸‰ì‹</button>
                        <button onclick="toggleView('album')" id="btn-view-album" class="flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm whitespace-nowrap">ì•¨ë²”</button>
                    </div>
                </div>
                
                <!-- ìš°ì¸¡ ìƒë‹¨ ê¸°ëŠ¥ ë²„íŠ¼ -->
                <div class="flex items-center gap-2 lg:gap-3">
                    <div id="auto-save-indicator" class="hidden sm:flex items-center gap-2 px-1 text-slate-400 font-bold transition-all opacity-0">
                        <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>
                    </div>

                    <div class="flex items-center gap-1 bg-white/30 backdrop-blur-md rounded-full px-2 lg:px-3 py-1 shadow-lg border border-white/20">
                        <button onclick="playPrev()" class="p-1.5 hover:scale-110 transition-all opacity-70 hover:opacity-100">
                            <i data-lucide="skip-back" class="w-3.5 h-3.5 lg:w-5 lg:h-5"></i>
                        </button>
                        <button id="music-play-btn" onclick="toggleMusic()" class="p-1.5 lg:p-2 hover:scale-110 transition-all dynamic-accent-text">
                            <i data-lucide="play" id="music-icon" class="w-5 h-5 lg:w-7 lg:h-7"></i>
                        </button>
                        <button onclick="playNext()" class="p-1.5 hover:scale-110 transition-all opacity-70 hover:opacity-100">
                            <i data-lucide="skip-forward" class="w-3.5 h-3.5 lg:w-5 lg:h-5"></i>
                        </button>
                        <button id="music-shuffle-btn" onclick="toggleShuffle()" class="p-1.5 hover:scale-110 transition-all opacity-40">
                            <i data-lucide="shuffle" class="w-3.5 h-3.5 lg:w-5 lg:h-5"></i>
                        </button>
                    </div>

                    <button onclick="openSettings()" class="p-2 lg:p-3 bg-white/30 backdrop-blur-md rounded-full hover:bg-white/50 transition-all shadow-lg border border-white/20">
                        <i data-lucide="settings" class="w-5 h-5 lg:w-8 lg:h-8"></i>
                    </button>
                </div>
            </div>

            <!-- ìš°ì¸¡ ì½˜í…ì¸  í‘œì‹œ ì˜ì—­ -->
            <div id="content-display-area" class="flex-1 overflow-y-auto pr-1 lg:pr-2 custom-scrollbar min-h-[300px] pb-10"></div>
        </section>
    </main>

    <!-- í™˜ê²½ ì„¤ì • ëª¨ë‹¬ -->
    <div id="settings-modal" class="fixed inset-0 bg-black/60 hidden items-start justify-center z-50 p-4 backdrop-blur-sm overflow-y-auto" onclick="handleOutsideClick(event)">
        <div class="bg-white rounded-[2rem] w-full max-w-4xl my-4 md:my-8 p-5 md:p-10 shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6 border-b pb-4 sticky top-0 bg-white z-10">
                <div class="flex items-center gap-2">
                    <i data-lucide="sliders" class="text-orange-500 w-6 h-6 md:w-8 md:h-8"></i>
                    <h3 class="text-lg md:text-3xl font-black text-slate-800 break-keep">í™˜ê²½ ì„¤ì •</h3>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="saveSettings()" class="px-4 py-2 bg-orange-500 text-white rounded-xl font-bold text-xs md:text-sm shadow-lg hover:bg-orange-600 transition-all">ì €ì¥</button>
                    <button onclick="closeSettings()" class="p-1.5 hover:bg-slate-100 rounded-full text-slate-400 transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
            </div>

            <div class="space-y-6 md:space-y-8 pb-4">
                <!-- ì œëª© ì„¸ë¶€ ì„¤ì • -->
                <div class="bg-indigo-50 p-4 md:p-6 rounded-2xl border border-indigo-100 space-y-4">
                    <h4 class="font-bold text-base md:text-xl flex items-center gap-2 text-indigo-700"><i data-lucide="type" class="w-5 h-5"></i> ì•± ì œëª© ì„¤ì •</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-indigo-400 ml-1">ì œëª© ë‚´ìš©</label>
                            <input type="text" id="title-text-input" class="p-2 border rounded-xl font-bold bg-white outline-none focus:ring-2 focus:ring-indigo-300 text-sm">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-indigo-400 ml-1">ê¸€ê¼´</label>
                            <select id="title-font-input" class="p-2 border rounded-xl font-bold bg-white outline-none text-sm">
                                <optgroup label="ê¸°ë³¸">
                                    <option value='"Pretendard Variable", Pretendard'>Pretendard</option>
                                    <option value='"Malgun Gothic", sans-serif'>ë§‘ì€ ê³ ë”•</option>
                                </optgroup>
                                <optgroup label="ë””ìì¸">
                                    <option value="'Bagel Fat One', cursive">ë² ì´ê¸€íŒ»ì›</option>
                                    <option value="'Black Han Sans', sans-serif">ê²€ì€ê³ ë”•</option>
                                    <option value="'Jua', sans-serif">ì£¼ì•„ì²´</option>
                                    <option value="'Dongle', sans-serif">ë™ê¸€ì²´</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-indigo-400 ml-1">í¬ê¸°</label>
                            <select id="title-size-input" class="p-2 border rounded-xl font-bold bg-white outline-none text-sm">
                                <option value="3xl">3xl</option><option value="4xl">4xl</option><option value="5xl">5xl</option>
                                <option value="6xl">6xl</option><option value="7xl">7xl</option><option value="8xl">8xl</option>
                            </select>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-indigo-400 ml-1">ìƒ‰ìƒ</label>
                            <div class="flex items-center gap-2 bg-white p-1 rounded-xl border border-indigo-100 h-[38px]">
                                <input type="color" id="title-color-input" class="w-10 h-7 border-none bg-transparent cursor-pointer">
                                <div class="flex items-center gap-1 pr-1">
                                    <input type="checkbox" id="title-sync-checkbox" class="scale-90" onchange="toggleTitleColorPicker(this.checked)">
                                    <label for="title-sync-checkbox" class="text-[9px] font-bold text-slate-500 whitespace-nowrap">í…Œë§ˆë§ì¶¤</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
                    <div class="lg:col-span-2 space-y-3 bg-orange-50 p-4 rounded-2xl border border-orange-100">
                        <h4 class="font-bold text-base flex items-center gap-2 text-orange-700"><i data-lucide="play-circle" class="w-5 h-5"></i> ì•¨ë²”/ìŒì•…</h4>
                        <div class="space-y-2">
                            <div class="flex gap-2">
                                <button onclick="document.getElementById('album-folder-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] hover:bg-orange-100">ì‚¬ì§„ í´ë”</button>
                                <button onclick="document.getElementById('album-file-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] hover:bg-orange-100">ì‚¬ì§„ íŒŒì¼</button>
                            </div>
                            <div class="flex items-center gap-2 bg-white/50 p-2 rounded-xl">
                                <span class="text-[10px] font-bold text-orange-600 whitespace-nowrap">ê°„ê²©(ì´ˆ):</span>
                                <input type="number" id="album-interval-input" min="1" max="60" class="flex-1 p-1 text-center font-bold border rounded-lg text-xs">
                            </div>
                            <div class="flex gap-2">
                                <button onclick="document.getElementById('music-folder-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] hover:bg-orange-100">ìŒì•… í´ë”</button>
                                <button onclick="document.getElementById('music-file-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] hover:bg-orange-100">ìŒì•… íŒŒì¼</button>
                            </div>
                            <p id="album-status-msg" class="text-[9px] text-slate-400 font-bold text-center">ì„ íƒëœ ë¯¸ë””ì–´ ì—†ìŒ</p>
                        </div>
                        <input type="file" id="album-folder-input" webkitdirectory directory multiple class="hidden" onchange="handleAlbumFiles(this)">
                        <input type="file" id="album-file-input" accept="image/*" multiple class="hidden" onchange="handleAlbumFiles(this)">
                        <input type="file" id="music-folder-input" webkitdirectory directory multiple class="hidden" onchange="loadMusic(this)">
                        <input type="file" id="music-file-input" accept="audio/*" multiple class="hidden" onchange="loadMusic(this)">
                    </div>

                    <!-- ë°°ê²½ í…Œë§ˆ ìƒ‰ìƒ ì„¤ì • -->
                    <div class="lg:col-span-3 space-y-3 bg-slate-50 p-4 rounded-2xl border border-slate-200">
                        <h4 class="font-bold text-base flex items-center gap-2 text-slate-700"><i data-lucide="palette" class="w-5 h-5"></i> ë°°ê²½ í…Œë§ˆ ìƒ‰ìƒ</h4>
                        <div class="grid grid-cols-5 gap-y-3 gap-x-2 justify-items-center py-1">
                            <div onclick="setThemeColor('default')" id="color-default" class="color-circle bg-[#FDFCFB]" title="ê¸°ë³¸"></div>
                            <div onclick="setThemeColor('pastel-blue')" id="color-pastel-blue" class="color-circle bg-[#E0F2FE]" title="ë¸”ë£¨"></div>
                            <div onclick="setThemeColor('pastel-indigo')" id="color-pastel-indigo" class="color-circle bg-[#E0E7FF]" title="ì¸ë””ê³ "></div>
                            <div onclick="setThemeColor('pastel-green')" id="color-pastel-green" class="color-circle bg-[#DCFCE7]" title="ê·¸ë¦°"></div>
                            <div onclick="setThemeColor('pastel-emerald')" id="color-pastel-emerald" class="color-circle bg-[#D1FAE5]" title="ì—ë©”ë„ë“œ"></div>
                            <div onclick="setThemeColor('pastel-teal')" id="color-pastel-teal" class="color-circle bg-[#CCFBF1]" title="í‹°ì•Œ"></div>
                            <div onclick="setThemeColor('pastel-cyan')" id="color-pastel-cyan" class="color-circle bg-[#CFFAFE]" title="ì‹œì•ˆ"></div>
                            <div onclick="setThemeColor('pastel-yellow')" id="color-pastel-yellow" class="color-circle bg-[#FEF9C3]" title="ì˜ë¡œìš°"></div>
                            <div onclick="setThemeColor('pastel-amber')" id="color-pastel-amber" class="color-circle bg-[#FEF3C7]" title="ì•°ë²„"></div>
                            <div onclick="setThemeColor('pastel-orange')" id="color-pastel-orange" class="color-circle bg-[#FFEDD5]" title="ì˜¤ë Œì§€"></div>
                            <div onclick="setThemeColor('pastel-pink')" id="color-pastel-pink" class="color-circle bg-[#FCE7F3]" title="í•‘í¬"></div>
                            <div onclick="setThemeColor('pastel-rose')" id="color-pastel-rose" class="color-circle bg-[#FFE4E6]" title="ë¡œì¦ˆ"></div>
                            <div onclick="setThemeColor('pastel-purple')" id="color-pastel-purple" class="color-circle bg-[#F3E8FF]" title="í¼í”Œ"></div>
                            <div onclick="setThemeColor('pastel-slate')" id="color-pastel-slate" class="color-circle bg-[#F1F5F9]" title="ìŠ¬ë ˆì´íŠ¸"></div>
                            <div onclick="document.getElementById('custom-color-input').click()" id="color-custom" class="color-circle bg-white text-slate-400" title="ì§ì ‘ ì„ íƒ">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                            </div>
                            <input type="color" id="custom-color-input" class="hidden" oninput="handleCustomColor(this.value)">
                        </div>
                    </div>
                </div>

                <div class="space-y-3 bg-blue-50 p-4 rounded-2xl border border-blue-100">
                    <h4 class="font-bold text-base flex items-center gap-2 text-blue-700"><i data-lucide="utensils" class="w-5 h-5"></i> ê¸‰ì‹ í•™êµ ì„¤ì •</h4>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <select id="region-select" class="p-2 border rounded-xl font-bold text-sm outline-none sm:w-32 bg-white">
                            <option value="B10">ì„œìš¸</option><option value="C10">ë¶€ì‚°</option><option value="D10">ëŒ€êµ¬</option>
                            <option value="E10">ì¸ì²œ</option><option value="F10">ê´‘ì£¼</option><option value="G10">ëŒ€ì „</option>
                            <option value="H10">ìš¸ì‚°</option><option value="I10">ì„¸ì¢…</option><option value="J10" selected>ê²½ê¸°</option>
                            <option value="K10">ê°•ì›</option><option value="M10">ì¶©ë¶</option><option value="N10">ì¶©ë‚¨</option>
                            <option value="P10">ì „ë¶</option><option value="Q10">ì „ë‚¨</option><option value="R10">ê²½ë¶</option>
                            <option value="S10">ê²½ë‚¨</option><option value="T10">ì œì£¼</option>
                        </select>
                        <div class="relative flex-1">
                            <input type="text" id="school-name-search" placeholder="í•™êµ ì´ë¦„ ì…ë ¥" class="w-full p-2 border rounded-xl font-bold text-sm outline-none bg-white">
                            <button onclick="searchSchoolInSettings()" class="absolute right-1.5 top-1.5 bg-blue-600 text-white px-3 py-1 rounded-lg font-bold text-[10px]">ê²€ìƒ‰</button>
                        </div>
                    </div>
                    <div id="school-search-results" class="space-y-1 mt-2 max-h-32 overflow-y-auto custom-scrollbar"></div>
                    <div id="selected-school-info" class="text-xs font-bold text-blue-600 mt-1"></div>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center px-1">
                        <h4 class="font-bold text-base flex items-center gap-2 text-slate-700"><i data-lucide="calendar-check" class="w-5 h-5"></i> D-Day</h4>
                        <button onclick="addRow('dday-editor')" class="px-3 py-1 bg-blue-50 text-blue-600 rounded-xl text-[10px] font-bold border border-blue-100">+ ì¶”ê°€</button>
                    </div>
                    <div id="dday-editor" class="space-y-2"></div>
                </div>

                <div class="space-y-4 bg-slate-50 p-4 rounded-2xl border border-slate-200">
                    <h4 class="font-bold text-base flex items-center gap-2 text-slate-700"><i data-lucide="layout-list" class="w-5 h-5"></i> ìš”ì¼ë³„ ìˆ˜ì—… ì‹œìˆ˜</h4>
                    <div class="grid grid-cols-5 gap-2">
                        <div class="text-center"><span class="text-[9px] font-bold text-slate-400">ì›”</span><select id="period-mon" class="w-full p-1.5 border rounded-xl text-xs font-black text-center bg-white"></select></div>
                        <div class="text-center"><span class="text-[9px] font-bold text-slate-400">í™”</span><select id="period-tue" class="w-full p-1.5 border rounded-xl text-xs font-black text-center bg-white"></select></div>
                        <div class="text-center"><span class="text-[9px] font-bold text-slate-400">ìˆ˜</span><select id="period-wed" class="w-full p-1.5 border rounded-xl text-xs font-black text-center bg-white"></select></div>
                        <div class="text-center"><span class="text-[9px] font-bold text-slate-400">ëª©</span><select id="period-thu" class="w-full p-1.5 border rounded-xl text-xs font-black text-center bg-white"></select></div>
                        <div class="text-center"><span class="text-[9px] font-bold text-slate-400">ê¸ˆ</span><select id="period-fri" class="w-full p-1.5 border rounded-xl text-xs font-black text-center bg-white"></select></div>
                    </div>
                </div>

                <div class="space-y-4 bg-slate-50 p-4 rounded-2xl border border-slate-200">
                    <h4 class="font-bold text-base flex items-center gap-2 text-slate-700"><i data-lucide="clock" class="w-5 h-5"></i> ì‹œì •í‘œ ê¸°ì¤€</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-slate-500">1êµì‹œ ì‹œì‘</label>
                            <input type="time" id="start-time-trigger" class="w-full p-2 border rounded-xl text-base font-black bg-white" onchange="autoCalculateSchedule(this.value, document.getElementById('lunch-after-input').value)">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] font-bold text-slate-500">ì ì‹¬ì‹œê°„</label>
                            <select id="lunch-after-input" class="w-full p-2 border rounded-xl text-base font-black bg-white" onchange="autoCalculateSchedule(document.getElementById('start-time-trigger').value, this.value)">
                                <option value="1">1êµì‹œ í›„ ì ì‹¬</option>
                                <option value="2">2êµì‹œ í›„ ì ì‹¬</option>
                                <option value="3">3êµì‹œ í›„ ì ì‹¬</option>
                                <option value="4" selected>4êµì‹œ í›„ ì ì‹¬</option>
                                <option value="5">5êµì‹œ í›„ ì ì‹¬</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <h4 class="font-bold text-base text-slate-700 px-1">ì‹œì •í‘œ í™•ì¸/ìˆ˜ì •</h4>
                    <div id="schedule-editor" class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-slate-800"></div>
                </div>

                <div class="mt-6 border-t pt-6 text-center">
                    <button onclick="saveSettings()" class="w-full py-4 bg-orange-500 text-white rounded-2xl font-black text-lg shadow-xl hover:bg-orange-600 transition-all">ì„¤ì • ì €ì¥ ë° ì ìš©</button>
                    <p class="mt-4 opacity-20 text-[10px]">Happy Class V3.56 Dashboard</p>
                </div>
            </div>
        </div>
    </div>

    <audio id="bgm-audio"></audio>
    <audio id="chime-audio" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        const NEIS_API_KEY = ""; 
        const NEIS_BASE_URL = "https://open.neis.go.kr/hub";

        let config = {
            viewMode: 'rules',
            notices: {},
            themeColor: 'pastel-indigo',
            customColor: '#ffffff',
            lunchAfter: 4,
            schoolInfo: null,
            isShuffle: false,
            albumIntervalSeconds: 5,
            titleConfig: {
                text: 'Happy Class',
                font: '"Pretendard Variable", Pretendard',
                size: '6xl',
                color: '#6366f1',
                syncWithTheme: true
            },
            ddays: [{ text: 'ì—¬ë¦„ë°©í•™', date: '2026-07-31' }],
            rules: [{ title: 'ì„œë¡œ ì¡´ì¤‘í•˜ê¸°', desc: 'ì¹œêµ¬ì˜ ë§ì— ê·€ ê¸°ìš¸ì´ê³ , ë‹¤ë¦„ì„ ì¸ì •í•´ìš”' }, { title: 'ìˆ˜ì—…ì— ì§‘ì¤‘í•˜ê¸°', desc: 'ê²½ì²­í•˜ê³  ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•´ìš”' }],
            announcements: [{ title: 'ì˜¤ëŠ˜ì˜ ë‚ ì”¨', desc: 'ë¯¸ì„¸ë¨¼ì§€ í™•ì¸ í›„ ë§ˆìŠ¤í¬ë¥¼ ì°©ìš©í•˜ì„¸ìš”' }],
            dailyPeriods: { 1: 6, 2: 6, 3: 5, 4: 6, 5: 6 },
            schedule: []
        };

        const THEMES = {
            'default': 'linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%)',
            'pastel-blue': '#E0F2FE', 'pastel-indigo': '#E0E7FF', 'pastel-green': '#DCFCE7',
            'pastel-emerald': '#D1FAE5', 'pastel-teal': '#CCFBF1', 'pastel-cyan': '#CFFAFE',
            'pastel-yellow': '#FEF9C3', 'pastel-amber': '#FEF3C7', 'pastel-orange': '#FFEDD5',
            'pastel-pink': '#FCE7F3', 'pastel-rose': '#FFE4E6', 'pastel-purple': '#F3E8FF',
            'pastel-slate': '#F1F5F9', 'custom': '' 
        };

        const ACCENTS = {
            'default': '#f97316', 'pastel-blue': '#0284c7', 'pastel-indigo': '#6366f1',
            'pastel-green': '#16a34a', 'pastel-emerald': '#059669', 'pastel-teal': '#0d9488',
            'pastel-cyan': '#0891b2', 'pastel-yellow': '#ca8a04', 'pastel-amber': '#d97706',
            'pastel-orange': '#ea580c', 'pastel-pink': '#db2777', 'pastel-rose': '#e11d48',
            'pastel-purple': '#9333ea', 'pastel-slate': '#475569', 'custom': '#f97316'
        };

        let mealDate = new Date();
        let noticeDate = new Date();
        let albumPhotos = []; 
        let albumIdx = 0;
        let albumInterval = null;
        let musicPlaylist = [];
        let currentMusicIdx = 0;

        const saved = localStorage.getItem('happy_class_config_v3_55');
        if (saved) {
            config = { ...config, ...JSON.parse(saved) };
        } else {
            const oldSaved = localStorage.getItem('happy_class_config_v3_54') || localStorage.getItem('happy_class_config_v3_51');
            if (oldSaved) config = { ...config, ...JSON.parse(oldSaved) };
        }
        
        if (!config.schedule || config.schedule.length === 0) config.schedule = generateDefaultSchedule('09:00', config.lunchAfter);

        const audioChime = document.getElementById('chime-audio');
        const audioBgm = document.getElementById('bgm-audio');

        function init() {
            lucide.createIcons();
            applyBackground();
            applyTitleConfig();
            renderContent();
            renderPeriodSelectors();
            updateTime();
            setInterval(updateTime, 1000);
            
            audioBgm.onended = () => { playNext(); };
            if (config.isShuffle) {
                const btn = document.getElementById('music-shuffle-btn');
                btn?.classList.add('btn-active');
                btn?.classList.replace('opacity-40', 'opacity-100');
            }
        }

        function applyTitleConfig() {
            const titleEl = document.getElementById('left-panel-title');
            if (!titleEl) return;
            const c = config.titleConfig;
            titleEl.innerText = c.text || 'Happy Class';
            titleEl.style.fontFamily = c.font || '"Pretendard Variable", Pretendard';
            const sizeClasses = ['text-3xl', 'text-4xl', 'text-5xl', 'text-6xl', 'text-7xl', 'text-8xl'];
            titleEl.classList.remove(...sizeClasses);
            titleEl.classList.add(`text-${c.size || '6xl'}`);
            if (c.syncWithTheme) {
                titleEl.classList.add('dynamic-accent-text');
                titleEl.style.removeProperty('color');
            } else {
                titleEl.classList.remove('dynamic-accent-text');
                titleEl.style.color = c.color || '#1e293b';
            }
        }

        function toggleTitleColorPicker(isSync) {
            const picker = document.getElementById('title-color-input');
            if (picker) picker.disabled = isSync;
        }

        function updateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const dayIdx = now.getDay();
            
            document.getElementById('date-display').innerText = `${year}. ${month}. ${date}`;
            document.getElementById('day-display').innerText = dayNames[dayIdx];
            let h = now.getHours() % 12 || 12;
            const ampm = now.getHours() >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
            document.getElementById('ampm-display').innerText = ampm;
            document.getElementById('time-display').innerText = `${String(h).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            document.getElementById('sec-display').innerText = String(now.getSeconds()).padStart(2,'0');
            updateStatus(now, dayIdx, `${month}-${date}`);
            updateDday(now);
        }

        function updateStatus(now, dayIdx, monthDay) {
            const currentTime = now.getHours() * 60 + now.getMinutes();
            let status = "Happy Ready";
            const HOLIDAYS = ['01-01', '03-01', '05-05', '06-06', '08-15', '10-03', '10-09', '12-25'];
            if (dayIdx === 0 || dayIdx === 6) status = "ì£¼ë§";
            else if (HOLIDAYS.includes(monthDay)) status = "ê³µíœ´ì¼";
            else {
                const max = config.dailyPeriods[dayIdx] || 6;
                let found = false;
                for (const item of config.schedule) {
                    const match = item.name.match(/(\d)êµì‹œ/);
                    if (match && parseInt(match[1]) > max) continue;
                    const [sH, sM] = item.start.split(':').map(Number);
                    const [eH, eM] = item.end.split(':').map(Number);
                    if (currentTime >= (sH * 60 + sM) && currentTime < (eH * 60 + eM)) {
                        status = item.name; found = true; break;
                    }
                }
                if (!found && currentTime >= 480) status = "ë°©ê³¼í›„ ì‹œê°„";
            }
            const badge = document.getElementById('status-badge');
            if (badge) {
                badge.innerText = status;
                badge.className = (status === "ì£¼ë§" || status === "ê³µíœ´ì¼") 
                    ? "glass inline-block px-5 lg:px-8 py-2 lg:py-4 rounded-2xl lg:rounded-3xl text-lg lg:text-3xl font-black shadow-xl border-white/50 text-red-500 mb-2"
                    : `glass inline-block px-5 lg:px-8 py-2 lg:py-4 rounded-2xl lg:rounded-3xl text-lg lg:text-3xl font-black shadow-xl border-white/50 mb-2 ${status.includes('êµì‹œ') ? 'dynamic-accent-text' : 'text-blue-600'}`;
            }
        }

        function updateDday(now) {
            const container = document.getElementById('dday-container');
            if(!container) return;
            container.innerHTML = '';
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            config.ddays.forEach(item => {
                const target = new Date(item.date);
                target.setHours(0,0,0,0);
                const diff = target - today;
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                if (days >= 0) {
                    const el = document.createElement('div');
                    el.className = "bg-white/60 backdrop-blur-sm px-3 lg:px-4 py-1.5 lg:py-2 rounded-xl lg:rounded-2xl border border-white/40 shadow-sm text-xs lg:text-lg font-bold text-slate-700";
                    el.innerText = days === 0 ? `${item.text} ğŸˆ` : `${item.text} D-${days}`;
                    container.appendChild(el);
                }
            });
        }

        function startAlbum() {
            if (albumInterval) clearInterval(albumInterval);
            if (albumPhotos.length > 1) {
                albumInterval = setInterval(() => {
                    const img = document.getElementById('album-image');
                    if (img) {
                        img.classList.add('fade-out');
                        setTimeout(() => {
                            albumIdx = (albumIdx + 1) % albumPhotos.length;
                            img.src = albumPhotos[albumIdx];
                            img.classList.remove('fade-out');
                        }, 800);
                    }
                }, (config.albumIntervalSeconds || 5) * 1000);
            }
        }
        function stopAlbum() { if (albumInterval) clearInterval(albumInterval); }
        
        function handleAlbumFiles(input) {
            const files = Array.from(input.files).filter(f => f.type.startsWith('image/'));
            if (files.length === 0) return;
            albumPhotos = files.map(f => URL.createObjectURL(f));
            albumIdx = 0;
            document.getElementById('album-status-msg').innerText = `${files.length}ì¥ ì„ íƒë¨`;
            if (config.viewMode === 'album') renderContent();
        }

        function toggleMusic() {
            if (musicPlaylist.length === 0) { openSettings(); return; }
            if (audioBgm.paused) {
                if (!audioBgm.src && musicPlaylist.length > 0) playTrack(0);
                else audioBgm.play();
                document.getElementById('music-icon').setAttribute('data-lucide', 'pause'); 
            } else {
                audioBgm.pause(); 
                document.getElementById('music-icon').setAttribute('data-lucide', 'play');
            }
            lucide.createIcons();
        }

        function playNext() {
            if (musicPlaylist.length === 0) return;
            if (config.isShuffle) currentMusicIdx = Math.floor(Math.random() * musicPlaylist.length);
            else currentMusicIdx = (currentMusicIdx + 1) % musicPlaylist.length;
            playTrack(currentMusicIdx);
        }

        function playPrev() {
            if (musicPlaylist.length === 0) return;
            currentMusicIdx = (currentMusicIdx - 1 + musicPlaylist.length) % musicPlaylist.length;
            playTrack(currentMusicIdx);
        }

        function toggleShuffle() {
            config.isShuffle = !config.isShuffle;
            const btn = document.getElementById('music-shuffle-btn');
            if (config.isShuffle) {
                btn?.classList.add('btn-active'); btn?.classList.replace('opacity-40', 'opacity-100');
            } else {
                btn?.classList.remove('btn-active'); btn?.classList.replace('opacity-100', 'opacity-40');
            }
            saveToLocal();
        }

        function loadMusic(input) {
            const files = Array.from(input.files).filter(f => f.type.startsWith('audio/'));
            if (files.length === 0) return;
            musicPlaylist = files.map(f => ({ url: URL.createObjectURL(f), name: f.name }));
            currentMusicIdx = 0;
            playTrack(0);
            document.getElementById('album-status-msg').innerText = `${files.length}ê³¡ ì„ íƒë¨`;
        }

        function playTrack(idx) {
            if (!musicPlaylist[idx]) return;
            audioBgm.src = musicPlaylist[idx].url;
            audioBgm.play().catch(e => console.log(e));
            document.getElementById('music-icon').setAttribute('data-lucide', 'pause');
            lucide.createIcons();
        }

        function setThemeColor(themeKey) {
            config.themeColor = themeKey;
            applyBackground(); applyTitleConfig(); updateColorSelectionUI(); renderContent(); saveToLocal();
        }

        function handleCustomColor(hex) {
            config.themeColor = 'custom'; config.customColor = hex;
            document.getElementById('color-custom').style.backgroundColor = hex;
            applyBackground(); applyTitleConfig(); updateColorSelectionUI(); renderContent(); saveToLocal();
        }

        function updateColorSelectionUI() {
            document.querySelectorAll('.color-circle').forEach(el => el.classList.remove('selected'));
            const targetId = config.themeColor === 'custom' ? 'color-custom' : `color-${config.themeColor}`;
            document.getElementById(targetId)?.classList.add('selected');
        }

        function getLuminance(hex) {
            if (!hex || hex.startsWith('linear-gradient')) return 0.9; 
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        function applyBackground() { 
            const bg = document.getElementById('bg-container');
            const themeValue = THEMES[config.themeColor] || THEMES['pastel-indigo'];
            let currentHex = themeValue;
            if (config.themeColor === 'default') { bg.style.background = THEMES['default']; } 
            else if (config.themeColor === 'custom') { bg.style.background = config.customColor; currentHex = config.customColor; } 
            else { bg.style.background = themeValue; }
            const accent = ACCENTS[config.themeColor] || ACCENTS['default'];
            document.documentElement.style.setProperty('--accent-color', accent);
            const luminance = getLuminance(currentHex);
            const isDark = luminance < 0.5;
            document.body.style.color = isDark ? '#F1F5F9' : '#1E293B';
            document.getElementById('status-badge')?.classList.replace(isDark ? 'glass' : 'glass-dark', isDark ? 'glass-dark' : 'glass');
        }

        function toggleView(mode) { 
            config.viewMode = mode; 
            if (mode === 'album') startAlbum(); else stopAlbum();
            renderContent(); saveToLocal(); 
        }

        async function renderContent() {
            const container = document.getElementById('content-display-area');
            const titleEl = document.getElementById('right-title');
            const subtitleEl = document.getElementById('right-subtitle');
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const subtitleMap = { 'rules': 'CLASS RULES', 'notice': 'NOTICE BOARD', 'announcements': 'ANNOUNCEMENTS', 'meal': 'SCHOOL MEALS', 'album': 'CLASS ALBUM' };

            ['rules', 'notice', 'announcements', 'meal', 'album'].forEach(m => {
                const btn = document.getElementById(`btn-view-${m}`);
                if(btn) {
                    btn.className = (config.viewMode === m) 
                        ? "flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-black transition-all text-[11px] lg:text-sm dynamic-accent-bg text-white shadow-lg" 
                        : "flex-1 md:flex-none px-3 lg:px-5 py-2 lg:py-2.5 rounded-xl font-bold transition-all text-[11px] lg:text-sm opacity-60 hover:opacity-100";
                }
            });

            subtitleEl.innerText = subtitleMap[config.viewMode] || 'SMART DASHBOARD';

            if (config.viewMode === 'album') {
                titleEl.innerText = "ìš°ë¦¬ ë°˜ ì•¨ë²”"; 
                if (albumPhotos.length === 0) {
                    container.innerHTML = `<div class="glass p-10 rounded-[2rem] h-full flex flex-col items-center justify-center opacity-50 fade-in-up"><i data-lucide="images" class="w-16 h-16 mb-4"></i><p class="text-lg font-bold">í™˜ê²½ ì„¤ì •ì—ì„œ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p></div>`;
                } else {
                    container.innerHTML = `<div class="w-full h-full flex items-center justify-center overflow-hidden fade-in-up"><img id="album-image" src="${albumPhotos[albumIdx]}" class="max-w-full max-h-full object-contain rounded-2xl shadow-2xl"></div>`;
                }
            } else if (config.viewMode === 'meal') {
                titleEl.innerText = "ì˜¤ëŠ˜ì˜ ê¸‰ì‹"; 
                container.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div></div>`;
                const data = await getMealData();
                const formattedDate = `${mealDate.getFullYear()}.${String(mealDate.getMonth()+1).padStart(2,'0')}.${String(mealDate.getDate()).padStart(2,'0')} (${dayNames[mealDate.getDay()]})`;
                let mealHtml = `<div class="glass p-5 lg:p-8 rounded-[1.5rem] lg:rounded-[2rem] shadow-xl h-full flex flex-col border-white/50 fade-in-up">
                    <div class="flex items-center justify-between mb-4 lg:mb-8">
                        <button onclick="changeMealDate(-1)" class="p-2 hover:bg-white/30 rounded-full"><i data-lucide="chevron-left"></i></button>
                        <span class="text-base lg:text-2xl font-black">${formattedDate}</span>
                        <button onclick="changeMealDate(1)" class="p-2 hover:bg-white/30 rounded-full"><i data-lucide="chevron-right"></i></button>
                    </div>`;
                if (data) {
                    const menus = data.DDISH_NM.split('<br/>').map(m => m.replace(/\([0-9.]+\)/g, '').trim());
                    mealHtml += `<div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-2 lg:gap-3">
                        ${menus.map(m => `<div class="p-2.5 lg:p-4 bg-white/40 rounded-xl font-bold text-sm lg:text-xl">${m}</div>`).join('')}
                    </div><div class="mt-4 text-right dynamic-accent-text font-bold text-xs lg:text-base">${data.CAL_INFO}</div>`;
                } else {
                    mealHtml += `<div class="flex-1 flex items-center justify-center opacity-40 py-10"><p class="text-lg font-bold">ì‹ë‹¨ ì •ë³´ ì—†ìŒ</p></div>`;
                }
                mealHtml += `</div>`; container.innerHTML = mealHtml;
            } else if (config.viewMode === 'notice') {
                titleEl.innerText = "ì•Œë¦¼ì¥"; 
                const ymdKey = noticeDate.toISOString().split('T')[0];
                const formattedDate = `${noticeDate.getFullYear()}.${String(noticeDate.getMonth()+1).padStart(2,'0')}.${String(noticeDate.getDate()).padStart(2,'0')} (${dayNames[noticeDate.getDay()]})`;
                container.innerHTML = `<div class="glass p-5 lg:p-8 rounded-[1.5rem] lg:rounded-[2rem] shadow-xl h-full flex flex-col border-white/50 fade-in-up">
                    <div class="flex items-center justify-between mb-4">
                        <button onclick="changeNoticeDate(-1)" class="p-2 hover:bg-white/30 rounded-full"><i data-lucide="chevron-left"></i></button>
                        <span class="text-base lg:text-2xl font-black">${formattedDate}</span>
                        <button onclick="changeNoticeDate(1)" class="p-2 hover:bg-white/30 rounded-full"><i data-lucide="chevron-right"></i></button>
                    </div><textarea id="notice-textarea" oninput="saveNoticeForDate(this.value)" placeholder="ì•Œë¦¼ì¥ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">${config.notices[ymdKey] || ''}</textarea></div>`;
            } else {
                const type = config.viewMode === 'rules' ? 'rules' : 'announcements';
                titleEl.innerText = type === 'rules' ? "ìš°ë¦¬ ë°˜ ì•½ì†" : "ê³µì§€ì‚¬í•­"; 
                let html = `<div class="space-y-3 lg:space-y-4 fade-in-up">`;
                config[type].forEach((item, idx) => {
                    html += `<div class="glass p-4 lg:p-6 rounded-[1.25rem] lg:rounded-[1.5rem] flex items-center gap-4 lg:gap-6 group">
                        <span class="text-xl lg:text-4xl font-black opacity-10">${String(idx + 1).padStart(2, '0')}</span>
                        <div class="flex-1">
                            <input type="text" value="${item.title}" oninput="config['${type}'][${idx}].title = this.value; saveToLocal();" class="editable-input text-base lg:text-2xl font-black" placeholder="ì œëª©">
                            <input type="text" value="${item.desc}" oninput="config['${type}'][${idx}].desc = this.value; saveToLocal();" class="editable-input text-xs lg:text-lg font-bold opacity-70" placeholder="ë‚´ìš©">
                        </div>
                        <button onclick="config['${type}'].splice(${idx}, 1); renderContent(); saveToLocal();" class="p-2 text-red-400 opacity-40 group-hover:opacity-100"><i data-lucide="trash-2" class="w-4 h-4 lg:w-5 lg:h-5"></i></button>
                    </div>`;
                });
                html += `<button onclick="config['${type}'].push({title:'', desc:''}); renderContent(); saveToLocal();" class="w-full py-3 lg:py-5 border-2 lg:border-4 border-dashed border-white/40 rounded-[1.5rem] text-slate-400 font-black hover:bg-white/20 text-sm lg:text-base">+ ì¶”ê°€í•˜ê¸°</button></div>`;
                container.innerHTML = html;
            }
            lucide.createIcons();
        }

        function changeMealDate(days) { mealDate.setDate(mealDate.getDate() + days); renderContent(); }
        function changeNoticeDate(days) { noticeDate.setDate(noticeDate.getDate() + days); renderContent(); }
        function saveNoticeForDate(val) { const ymd = noticeDate.toISOString().split('T')[0]; config.notices[ymd] = val; saveToLocal(); showAutoSaveIndicator(); }

        async function fetchNEIS(endpoint, params) { const q = new URLSearchParams({ Type:'json', KEY:NEIS_API_KEY, ...params }); const r = await fetch(`${NEIS_BASE_URL}/${endpoint}?${q}`); return await r.json(); }
        async function getMealData() {
            if (!config.schoolInfo) return null;
            const ymd = mealDate.getFullYear() + String(mealDate.getMonth() + 1).padStart(2, '0') + String(mealDate.getDate()).padStart(2, '0');
            try { const data = await fetchNEIS('mealServiceDietInfo', { ATPT_OFCDC_SC_CODE: config.schoolInfo.atptCode, SD_SCHUL_CODE: config.schoolInfo.schulCode, MLSV_YMD: ymd }); return data.mealServiceDietInfo ? data.mealServiceDietInfo[1].row[0] : null; } catch (e) { return null; }
        }

        async function searchSchoolInSettings() {
            const r = document.getElementById('region-select').value; const n = document.getElementById('school-name-search').value.trim(); if(!n) return;
            const res = document.getElementById('school-search-results'); res.innerHTML='<div class="text-xs p-2">ê²€ìƒ‰ ì¤‘...</div>';
            try { 
                const d = await fetchNEIS('schoolInfo', { ATPT_OFCDC_SC_CODE:r, SCHUL_NM:n });
                if(d.schoolInfo) {
                    res.innerHTML = d.schoolInfo[1].row.map(s => `
                        <button onclick="selectSchool('${s.ATPT_OFCDC_SC_CODE}', '${s.SD_SCHUL_CODE}', '${s.SCHUL_NM}')" class="w-full text-left p-2 border rounded-xl hover:bg-blue-50">
                            <div class="text-xs font-bold text-slate-800">${s.SCHUL_NM}</div>
                            <div class="text-[9px] text-slate-400 mt-0.5">${s.ORG_RDNMA || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</div>
                        </button>`).join('');
                } else res.innerHTML = '<div class="text-xs p-2">ê²°ê³¼ ì—†ìŒ</div>';
            } catch(e){ res.innerHTML = '<div class="text-xs p-2 text-red-500">ì˜¤ë¥˜ ë°œìƒ</div>'; }
        }
        function selectSchool(atpt, schul, name) { config.tempSchool = { atptCode:atpt, schulCode:schul, schulNm:name }; document.getElementById('selected-school-info').innerText=`âœ… ì„ íƒë¨: ${name}`; }

        function generateDefaultSchedule(startTime, lunchAfter = 4) {
            const [h, m] = startTime.split(':').map(Number); let current = h * 60 + m;
            const format = (min) => `${String(Math.floor(min/60)).padStart(2,'0')}:${String(min%60).padStart(2,'0')}`;
            let sch = [{ name: 'ì•„ì¹¨ììŠµ', start: '08:30', end: format(current) }];
            for(let i=1; i<=6; i++) {
                sch.push({ name: `${i}êµì‹œ`, start: format(current), end: format(current+40) }); current += 40;
                if (i == lunchAfter) { sch.push({ name: 'ì ì‹¬ ì‹œê°„', start: format(current), end: format(current+50) }); current += 50; } 
                else if (i < 6) { sch.push({ name: 'ì‰¬ëŠ” ì‹œê°„', start: format(current), end: format(current+10) }); current += 10; }
            }
            return sch;
        }

        function renderScheduleEditor(schArray) {
            const ed = document.getElementById('schedule-editor'); if(!ed) return;
            ed.innerHTML = schArray.map(s => `<div class="flex flex-col gap-1 border p-2.5 rounded-xl bg-white schedule-item-row"><span class="font-bold text-[9px] text-slate-400 uppercase sch-name">${s.name}</span><div class="flex items-center gap-1"><input type="text" value="${s.start}" class="sch-start-in w-full p-1 border rounded-lg text-xs font-black text-center"><span>~</span><input type="text" value="${s.end}" class="sch-end-in w-full p-1 border rounded-lg text-xs font-black text-center"></div></div>`).join('');
        }

        function autoCalculateSchedule(st, la) { renderScheduleEditor(generateDefaultSchedule(st || "09:00", parseInt(la))); }

        function openSettings() {
            const modal = document.getElementById('settings-modal');
            if (modal) modal.style.display = 'flex'; 
            document.getElementById('lunch-after-input').value = config.lunchAfter || 4; 
            document.getElementById('album-interval-input').value = config.albumIntervalSeconds || 5;
            document.getElementById('title-text-input').value = config.titleConfig.text || 'Happy Class';
            document.getElementById('title-font-input').value = config.titleConfig.font || '"Pretendard Variable", Pretendard';
            document.getElementById('title-size-input').value = config.titleConfig.size || '6xl';
            document.getElementById('title-color-input').value = config.titleConfig.color || '#6366f1';
            document.getElementById('title-sync-checkbox').checked = config.titleConfig.syncWithTheme;
            toggleTitleColorPicker(config.titleConfig.syncWithTheme);
            const de = document.getElementById('dday-editor'); de.innerHTML = '';
            config.ddays.forEach(d => addRow('dday-editor', d.text, d.date)); 
            const f = config.schedule.find(s => s.name === '1êµì‹œ'); if (f) document.getElementById('start-time-trigger').value = f.start;
            document.getElementById('selected-school-info').innerText = config.schoolInfo ? `âœ… í˜„ì¬: ${config.schoolInfo.schulNm}` : "";
            if (config.themeColor === 'custom') { document.getElementById('color-custom').style.backgroundColor = config.customColor; document.getElementById('custom-color-input').value = config.customColor; }
            renderPeriodSelectors(); renderScheduleEditor(config.schedule); updateColorSelectionUI(); lucide.createIcons();
        }

        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
        function handleOutsideClick(e) { if (e.target.id === 'settings-modal') closeSettings(); }

        function saveSettings() {
            config.lunchAfter = parseInt(document.getElementById('lunch-after-input').value); 
            config.albumIntervalSeconds = parseInt(document.getElementById('album-interval-input').value) || 5;
            config.titleConfig = {
                text: document.getElementById('title-text-input').value, font: document.getElementById('title-font-input').value,
                size: document.getElementById('title-size-input').value, color: document.getElementById('title-color-input').value,
                syncWithTheme: document.getElementById('title-sync-checkbox').checked
            };
            if(config.tempSchool) { config.schoolInfo = config.tempSchool; delete config.tempSchool; }
            const dt = document.querySelectorAll('.dday-title-in'); const dd = document.querySelectorAll('.dday-date-in'); config.ddays = [];
            dt.forEach((t, i) => { if (t.value.trim() && dd[i].value) config.ddays.push({ text: t.value, date: dd[i].value }); });
            config.dailyPeriods = { 1: parseInt(document.getElementById('period-mon').value), 2: parseInt(document.getElementById('period-tue').value), 3: parseInt(document.getElementById('period-wed').value), 4: parseInt(document.getElementById('period-thu').value), 5: parseInt(document.getElementById('period-fri').value) };
            const sRows = document.querySelectorAll('.schedule-item-row'); config.schedule = [];
            sRows.forEach(r => { config.schedule.push({ name: r.querySelector('.sch-name').innerText, start: r.querySelector('.sch-start-in').value, end: r.querySelector('.sch-end-in').value }); });
            saveToLocal(); applyBackground(); applyTitleConfig(); renderContent(); updateTime(); 
            if (config.viewMode === 'album') startAlbum();
            closeSettings(); showAutoSaveIndicator();
        }

        function saveToLocal() { localStorage.setItem('happy_class_config_v3_55', JSON.stringify(config)); }
        function showAutoSaveIndicator() { const i = document.getElementById('auto-save-indicator'); if(i) { i.style.opacity = '1'; setTimeout(() => { i.style.opacity = '0'; }, 1000); } }

        function renderPeriodSelectors() {
            ['mon', 'tue', 'wed', 'thu', 'fri'].forEach((day, idx) => {
                const select = document.getElementById(`period-${day}`); if (!select) return;
                let options = ''; for (let i = 4; i <= 6; i++) { const selected = config.dailyPeriods[idx + 1] == i ? 'selected' : ''; options += `<option value="${i}" ${selected}>${i}</option>`; }
                select.innerHTML = options;
            });
        }

        function addRow(id, t="", d="") {
            const e = document.getElementById(id); const r = document.createElement('div'); r.className = "flex gap-2 items-center dday-row";
            r.innerHTML = `<input type="text" value="${t}" class="dday-title-in flex-1 p-2 border rounded-xl text-xs font-bold bg-white" placeholder="ì´ë¦„"><input type="date" value="${d}" class="dday-date-in p-2 border rounded-xl text-xs font-bold bg-white"><button onclick="this.parentElement.remove()" class="p-1.5 text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`;
            e.appendChild(r); lucide.createIcons();
        }

        window.onload = init;
    </script>
</body>
</html>
