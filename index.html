<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Class (V3.47)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts (Pretendard & Pretty Fonts) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Black+Han+Sans&family=Dongle:wght@400;700&family=Gowun+Batang:wght@400;700&family=Jua&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent-color: #6366f1;
        }
        body {
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }
        /* PCÏóêÏÑúÎäî Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ, Î™®Î∞îÏùºÏóêÏÑúÎäî ÎÇ¥Ïö©Ïóê Îî∞Îùº ÌóàÏö© */
        @media (min-height: 700px) {
            body { overflow-y: hidden; }
        }
        .glass {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .text-shadow-lg { text-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.1); }
        .text-shadow-strong { text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        
        #bg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-size: cover; background-position: center;
            transition: all 0.8s ease;
        }
        .left-content-shadow { background: linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 100%); }
        @media (min-width: 1024px) {
            .left-content-shadow { background: linear-gradient(to right, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 100%); }
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        
        .editable-input { background: transparent; border: none; outline: none; width: 100%; padding: 2px 0; }
        .editable-input:focus { background: rgba(255,255,255,0.3); border-radius: 4px; }
        
        #notice-textarea { 
            background: transparent; border: none; outline: none; resize: none; 
            width: 100%; height: 100%; font-size: 1.5rem; line-height: 1.5; 
            font-weight: 800; 
        }
        @media (min-width: 1024px) {
            #notice-textarea { font-size: 2.2rem; line-height: 1.6; }
        }

        #album-image {
            transition: opacity 1s ease-in-out;
            opacity: 1;
        }
        .fade-out { opacity: 0 !important; }

        .loader { 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid var(--accent-color); 
            border-radius: 50%; 
            width: 30px; height: 30px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .dynamic-accent-text { color: var(--accent-color) !important; }
        .dynamic-accent-bg { background-color: var(--accent-color) !important; }
        
        .btn-active { color: var(--accent-color) !important; background: rgba(255, 255, 255, 0.4); border-radius: 50%; }
        
        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px; height: 12px;
            background: var(--accent-color);
            cursor: pointer; border-radius: 50%;
        }

        .color-circle {
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            border: 3px solid white; transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
        }
        .color-circle:hover { transform: translateY(-2px) scale(1.1); }
        .color-circle.selected { border-color: var(--accent-color); transform: scale(1.1); }

        .custom-checkbox {
            width: 18px; height: 18px; cursor: pointer;
            accent-color: var(--accent-color);
        }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex items-center justify-center p-3 sm:p-6">
    <div id="bg-container"></div>

    <main class="w-full h-full lg:h-full flex flex-col lg:flex-row gap-4 lg:gap-6 z-10 max-w-[1920px]">
        <!-- Ï¢åÏ∏° ÏòÅÏó≠ -->
        <section id="left-panel" class="w-full lg:w-[38%] flex flex-col justify-between pt-4 sm:pt-6 lg:pt-8 pb-6 sm:pb-8 lg:pb-12 px-4 sm:px-6 left-content-shadow text-shadow-lg">
            <div class="space-y-12 sm:space-y-16 lg:space-y-24 text-center lg:text-left">
                <!-- ÌÉÄÏù¥ÌãÄ -->
                <h1 id="left-panel-title" class="text-4xl sm:text-5xl lg:text-6xl font-black tracking-tighter text-shadow-strong">Happy Class</h1>
                
                <div class="space-y-0.5 sm:space-y-1">
                    <div id="date-display" class="text-xl sm:text-2xl lg:text-3xl font-bold tracking-tight opacity-90">2026. 02. 28</div>
                    <!-- ÏöîÏùº ÏÉâÏÉÅ ÏàòÏ†ï: ÌÖåÎßà ÏÉâÏÉÅÏùÑ Î∞òÏòÅÌïòÎèÑÎ°ù dynamic-accent-text Ï†ÅÏö© -->
                    <div id="day-display" class="text-3xl sm:text-4xl lg:text-5xl font-black dynamic-accent-text">ÌÜ†ÏöîÏùº</div>
                </div>
            </div>

            <!-- ÏãúÍ∞Ñ ÌëúÏãúÎ∂Ä -->
            <div class="flex flex-col gap-0 my-6 sm:my-8 lg:mt-8 items-center lg:items-start">
                <div class="flex flex-col items-center lg:items-start">
                    <span id="ampm-display" class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-1 lg:mb-2 dynamic-accent-text">Ïò§Ï†Ñ</span>
                    <div class="flex items-baseline">
                        <span id="time-display" class="text-6xl sm:text-8xl lg:text-[10rem] font-black leading-none tracking-tighter text-shadow-strong">07:35</span>
                        <span class="text-2xl sm:text-3xl lg:text-4xl font-bold opacity-50 ml-2 sm:ml-4">: <span id="sec-display">28</span></span>
                    </div>
                </div>
            </div>

            <div class="space-y-3 flex flex-col items-center lg:items-start">
                <div id="status-badge" class="glass inline-block px-6 py-3 lg:px-8 lg:py-4 rounded-2xl lg:rounded-3xl text-xl sm:text-2xl lg:text-3xl font-black shadow-xl border-white/50 mb-2">ÏïÑÏπ®ÏûêÏäµ</div>
                <div id="dday-container" class="flex flex-wrap justify-center lg:justify-start gap-2 max-w-full"></div>
            </div>
        </section>

        <!-- Ïö∞Ï∏° ÏòÅÏó≠ -->
        <section id="right-panel" class="w-full lg:w-[62%] flex flex-col p-2 sm:p-4">
            <div class="flex flex-col sm:flex-row justify-between items-center sm:items-end mb-4 sm:mb-8 gap-4">
                <div class="flex flex-col items-center sm:items-start gap-2 sm:gap-4 w-full sm:w-auto">
                    <div class="text-center sm:text-left">
                        <h2 id="right-title" class="text-3xl sm:text-4xl lg:text-5xl font-black dynamic-accent-text mb-0.5 text-shadow-lg">Dashboard</h2>
                        <p id="right-subtitle" class="text-xs sm:text-sm lg:text-lg font-bold tracking-widest opacity-70 uppercase">Smart Classroom</p>
                    </div>
                    <!-- ÌÉ≠ Ï†ÑÌôò Î≤ÑÌäº -->
                    <div class="flex bg-white/20 p-1 rounded-xl backdrop-blur-sm border border-white/20 flex-nowrap overflow-x-auto custom-scrollbar max-w-[95vw]">
                        <button onclick="toggleView('rules')" id="btn-view-rules" class="px-3 sm:px-4 py-2 rounded-lg font-bold transition-all text-xs sm:text-sm whitespace-nowrap">ÏïΩÏÜç</button>
                        <button onclick="toggleView('notice')" id="btn-view-notice" class="px-3 sm:px-4 py-2 rounded-lg font-bold transition-all text-xs sm:text-sm whitespace-nowrap">ÏïåÎ¶ºÏû•</button>
                        <button onclick="toggleView('announcements')" id="btn-view-announcements" class="px-3 sm:px-4 py-2 rounded-lg font-bold transition-all text-xs sm:text-sm whitespace-nowrap">Í≥µÏßÄ</button>
                        <button onclick="toggleView('meal')" id="btn-view-meal" class="px-3 sm:px-4 py-2 rounded-lg font-bold transition-all text-xs sm:text-sm whitespace-nowrap">Í∏âÏãù</button>
                        <button onclick="toggleView('album')" id="btn-view-album" class="px-3 sm:px-4 py-2 rounded-lg font-bold transition-all text-xs sm:text-sm whitespace-nowrap">Ïï®Î≤î</button>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 sm:gap-3">
                    <div id="auto-save-indicator" class="hidden sm:flex items-center gap-2 px-2 text-slate-400 font-bold transition-all opacity-0">
                        <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>
                    </div>

                    <div class="flex items-center gap-1 bg-white/30 backdrop-blur-md rounded-full px-2 py-1 sm:px-3 sm:py-1 shadow-lg border border-white/20">
                        <button onclick="playPrev()" class="p-1 hover:scale-110 transition-all opacity-70">
                            <i data-lucide="skip-back" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                        </button>
                        <button id="music-play-btn" onclick="toggleMusic()" class="p-1.5 hover:scale-110 transition-all dynamic-accent-text">
                            <i data-lucide="play" id="music-icon" class="w-6 h-6 sm:w-7 sm:h-7"></i>
                        </button>
                        <button onclick="playNext()" class="p-1 hover:scale-110 transition-all opacity-70">
                            <i data-lucide="skip-forward" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                        </button>
                        <button id="music-shuffle-btn" onclick="toggleShuffle()" class="hidden sm:block p-1 hover:scale-110 transition-all ml-1 opacity-40">
                            <i data-lucide="shuffle" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                        </button>
                        <input type="range" id="music-volume" min="0" max="1" step="0.1" value="0.5" class="w-8 sm:w-10 h-1 bg-white/40 rounded-lg appearance-none cursor-pointer mx-1 sm:mx-2" oninput="setVolume(this.value)">
                    </div>

                    <button onclick="openSettings()" class="p-2 sm:p-3 bg-white/30 backdrop-blur-md rounded-full hover:bg-white/50 transition-all shadow-lg border border-white/20">
                        <i data-lucide="settings" class="w-6 h-6 sm:w-8 sm:h-8"></i>
                    </button>
                </div>
            </div>

            <div id="content-display-area" class="flex-1 overflow-y-auto pr-1 sm:pr-2 custom-scrollbar min-h-[300px]"></div>
            <div class="h-4 sm:h-8"></div>
        </section>
    </main>

    <!-- ÌôòÍ≤Ω ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="settings-modal" class="fixed inset-0 bg-black/60 hidden items-start justify-center z-50 p-2 sm:p-4 backdrop-blur-sm overflow-y-auto" onclick="handleOutsideClick(event)">
        <div class="bg-white rounded-[1.5rem] sm:rounded-[2.5rem] w-full max-w-4xl my-4 sm:my-8 p-5 sm:p-10 shadow-2xl relative" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4 sm:mb-6 border-b pb-4">
                <div class="flex items-center gap-2 sm:gap-3">
                    <i data-lucide="sliders" class="text-orange-500 w-6 h-6 sm:w-8 sm:h-8"></i>
                    <h3 class="text-xl sm:text-3xl font-black text-slate-800">ÌôòÍ≤Ω ÏÑ§Ï†ï</h3>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="saveSettings()" class="px-4 py-1.5 sm:px-6 sm:py-2 bg-orange-500 text-white rounded-xl font-bold text-xs sm:text-sm shadow-lg hover:bg-orange-600 transition-all">ÏÑ§Ï†ï Ï†ÄÏû•</button>
                    <button onclick="closeSettings()" class="p-1 sm:p-2 hover:bg-slate-100 rounded-full text-slate-400"><i data-lucide="x" class="w-6 h-6 sm:w-8 sm:h-8"></i></button>
                </div>
            </div>

            <div class="space-y-6 sm:space-y-8 pb-4">
                <div class="bg-indigo-50 p-4 sm:p-6 rounded-2xl border border-indigo-100 space-y-4">
                    <h4 class="font-bold text-lg sm:text-xl flex items-center gap-2 text-indigo-700"><i data-lucide="type" class="w-5 h-5 sm:w-6 sm:h-6"></i> Ïï± Ï†úÎ™© ÏÑ∏Î∂Ä ÏÑ§Ï†ï</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-bold text-indigo-400 ml-1">Ï†úÎ™© ÎÇ¥Ïö©</label>
                            <input type="text" id="title-text-input" class="p-2 border rounded-xl font-bold bg-white text-slate-700 outline-none focus:ring-2 focus:ring-indigo-300">
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-bold text-indigo-400 ml-1">Í∏ÄÍº¥ ÏÑ†ÌÉù</label>
                            <select id="title-font-input" class="p-2 border rounded-xl font-bold bg-white text-slate-700 outline-none">
                                <optgroup label="Í∏∞Î≥∏ Í∏ÄÍº¥">
                                    <option value='"Pretendard Variable", Pretendard'>Pretendard (Í∏∞Î≥∏)</option>
                                    <option value='"Malgun Gothic", sans-serif'>ÎßëÏùÄ Í≥†Îîï</option>
                                </optgroup>
                                <optgroup label="ÏòàÏÅú Í∏ÄÍº¥">
                                    <option value="'Bagel Fat One', cursive">Î≤†Ïù¥Í∏ÄÌåªÏõê</option>
                                    <option value="'Black Han Sans', sans-serif">Í≤ÄÏùÄÍ≥†Îîï</option>
                                    <option value="'Jua', sans-serif">Ï£ºÏïÑÏ≤¥</option>
                                    <option value="'Dongle', sans-serif">ÎèôÍ∏ÄÏ≤¥</option>
                                    <option value="'Gowun Batang', serif">Í≥†Ïö¥Î∞îÌÉï</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-bold text-indigo-400 ml-1">Í∏ÄÏûê ÌÅ¨Í∏∞</label>
                            <select id="title-size-input" class="p-2 border rounded-xl font-bold bg-white text-slate-700 outline-none">
                                <option value="4xl">4xl</option><option value="5xl">5xl</option>
                                <option value="6xl">6xl</option><option value="7xl">7xl</option>
                                <option value="8xl">8xl</option><option value="9xl">9xl</option>
                            </select>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-xs font-bold text-indigo-400 ml-1">Í∏ÄÏûê ÏÉâÏÉÅ</label>
                            <div class="flex items-center gap-2 bg-white p-1 rounded-xl border border-indigo-100 h-[42px]">
                                <input type="color" id="title-color-input" class="w-10 h-8 border-none bg-transparent cursor-pointer disabled:opacity-30">
                                <div class="h-4 w-px bg-slate-200"></div>
                                <div class="flex items-center gap-1 pr-1">
                                    <input type="checkbox" id="title-sync-checkbox" class="custom-checkbox scale-75" onchange="toggleTitleColorPicker(this.checked)">
                                    <label for="title-sync-checkbox" class="text-[10px] font-bold text-slate-500 whitespace-nowrap">ÌÖåÎßà ÎßûÏ∂§</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 text-slate-800">
                    <div class="lg:col-span-2 space-y-3 bg-orange-50 p-4 sm:p-5 rounded-2xl border border-orange-100">
                        <h4 class="font-bold text-lg flex items-center gap-2 text-orange-700"><i data-lucide="play-circle" class="w-5 h-5"></i> Ïï®Î≤î Î∞è ÏùåÏïÖ</h4>
                        <div class="flex flex-col gap-2">
                            <div class="flex gap-2">
                                <button onclick="document.getElementById('album-folder-input').click()" class="flex-1 flex items-center justify-center gap-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] sm:text-xs">
                                    <i data-lucide="folder-open" class="w-3 h-3"></i> Ìè¥Îçî ÏÑ†ÌÉù
                                </button>
                                <button onclick="document.getElementById('album-file-input').click()" class="flex-1 flex items-center justify-center gap-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] sm:text-xs">
                                    <i data-lucide="image" class="w-3 h-3"></i> ÌååÏùº ÏÑ†ÌÉù
                                </button>
                            </div>
                            <div class="flex items-center gap-2 bg-white/50 p-2 rounded-xl border border-orange-100">
                                <span class="text-[10px] sm:text-xs font-bold text-orange-600 whitespace-nowrap">Ï†ÑÌôò Í∞ÑÍ≤©(Ï¥à):</span>
                                <input type="number" id="album-interval-input" min="1" max="60" class="flex-1 p-1 text-center font-bold border rounded-lg outline-none text-sm">
                            </div>
                            <input type="file" id="album-folder-input" webkitdirectory directory multiple class="hidden" onchange="handleAlbumFiles(this)">
                            <input type="file" id="album-file-input" accept="image/*" multiple class="hidden" onchange="handleAlbumFiles(this)">
                            <div class="flex gap-2">
                                <button onclick="document.getElementById('music-folder-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] sm:text-xs">ÏùåÏïÖ Ìè¥Îçî</button>
                                <button onclick="document.getElementById('music-file-input').click()" class="flex-1 p-2 bg-white border border-orange-200 text-orange-600 rounded-xl font-bold text-[10px] sm:text-xs">ÏùåÏïÖ ÌååÏùº</button>
                            </div>
                            <input type="file" id="music-folder-input" webkitdirectory directory multiple class="hidden" onchange="loadMusic(this)">
                            <input type="file" id="music-file-input" accept="audio/*" multiple class="hidden" onchange="loadMusic(this)">
                            <p id="album-status-msg" class="text-[10px] text-slate-400 font-bold text-center">ÎØ∏ÎîîÏñ¥ Ï†ïÎ≥¥ ÏóÜÏùå</p>
                        </div>
                    </div>

                    <div class="lg:col-span-3 space-y-3 bg-slate-50 p-4 sm:p-5 rounded-2xl border border-slate-200">
                        <h4 class="font-bold text-lg text-slate-700 flex items-center gap-2"><i data-lucide="palette" class="w-5 h-5"></i> Î∞∞Í≤Ω ÌÖåÎßà</h4>
                        <div class="grid grid-cols-4 sm:grid-cols-6 gap-2 sm:gap-3 py-1 items-center justify-items-center">
                            <div onclick="setThemeColor('default')" id="color-default" class="color-circle bg-[#FDFCFB] w-8 h-8 sm:w-10 sm:h-10"></div>
                            <div onclick="setThemeColor('pastel-blue')" id="color-pastel-blue" class="color-circle bg-[#E0F2FE] w-8 h-8 sm:w-10 sm:h-10"></div>
                            <div onclick="setThemeColor('pastel-indigo')" id="color-pastel-indigo" class="color-circle bg-[#E0E7FF] w-8 h-8 sm:w-10 sm:h-10"></div>
                            <div onclick="setThemeColor('pastel-green')" id="color-pastel-green" class="color-circle bg-[#DCFCE7] w-8 h-8 sm:w-10 sm:h-10"></div>
                            <div onclick="setThemeColor('pastel-pink')" id="color-pastel-pink" class="color-circle bg-[#FCE7F3] w-8 h-8 sm:w-10 sm:h-10"></div>
                            <div onclick="document.getElementById('custom-color-input').click()" id="color-custom" class="color-circle bg-white text-slate-400 w-8 h-8 sm:w-10 sm:h-10"><i data-lucide="plus" class="w-5 h-5 sm:w-6 sm:h-6"></i></div>
                            <input type="color" id="custom-color-input" class="hidden" oninput="handleCustomColor(this.value)">
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="font-bold text-xl text-slate-700 flex items-center gap-2"><i data-lucide="utensils" class="w-6 h-6"></i> Í∏âÏãù ÌïôÍµê</h4>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <select id="region-select" class="p-3 border rounded-xl font-bold bg-white">
                            <option value="J10" selected>Í≤ΩÍ∏∞</option><option value="B10">ÏÑúÏö∏</option><option value="C10">Î∂ÄÏÇ∞</option>
                        </select>
                        <div class="relative flex-1">
                            <input type="text" id="school-name-search" placeholder="ÌïôÍµê Ïù¥Î¶Ñ" class="w-full p-3 border rounded-xl font-bold bg-white">
                            <button onclick="searchSchoolInSettings()" class="absolute right-2 top-2 bg-blue-600 text-white px-3 py-1.5 rounded-lg font-bold text-xs">Í≤ÄÏÉâ</button>
                        </div>
                    </div>
                    <div id="school-search-results" class="max-h-32 overflow-y-auto"></div>
                    <div id="selected-school-info" class="text-sm font-bold text-blue-600"></div>
                </div>

                <div class="pt-6 border-t text-center">
                    <button onclick="saveSettings()" class="w-full py-4 bg-orange-500 text-white rounded-2xl font-black text-xl shadow-xl">Î™®Îì† ÏÑ§Ï†ï Ï†ÄÏû• Î∞è Ï†ÅÏö©</button>
                    <p class="mt-4 opacity-20 text-xs tracking-widest uppercase">Happy Class V3.47 Dashboard</p>
                </div>
            </div>
        </div>
    </div>

    <audio id="bgm-audio"></audio>
    <audio id="chime-audio" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        const NEIS_API_KEY = ""; 
        const NEIS_BASE_URL = "https://open.neis.go.kr/hub";

        let config = {
            viewMode: 'rules',
            notices: {},
            themeColor: 'pastel-indigo', 
            customColor: '#ffffff',
            lunchAfter: 4,
            schoolInfo: null,
            isShuffle: false,
            albumIntervalSeconds: 5,
            titleConfig: {
                text: 'Happy Class',
                font: '"Pretendard Variable", Pretendard',
                size: '6xl',
                color: '#6366f1',
                syncWithTheme: true
            },
            ddays: [{ text: 'Ïó¨Î¶ÑÎ∞©Ìïô', date: '2026-07-31' }],
            rules: [{ title: 'ÏÑúÎ°ú Ï°¥Ï§ëÌïòÍ∏∞', desc: 'ÏπúÍµ¨Ïùò ÎßêÏóê Í∑Ä Í∏∞Ïö∏Ïù¥Í≥† Ïù∏Ï†ïÌï¥Ïöî' }, { title: 'ÏàòÏóÖÏóê ÏßëÏ§ëÌïòÍ∏∞', desc: 'Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÏàòÏóÖÏóê Ï∞∏Ïó¨Ìï¥Ïöî' }],
            announcements: [{ title: 'ÏïàÎÇ¥', desc: 'ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.' }],
            dailyPeriods: { 1: 6, 2: 6, 3: 5, 4: 6, 5: 6 },
            schedule: []
        };

        const THEMES = {
            'default': 'linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%)',
            'pastel-blue': '#E0F2FE', 'pastel-indigo': '#E0E7FF', 'pastel-green': '#DCFCE7',
            'pastel-pink': '#FCE7F3', 'custom': '' 
        };

        const ACCENTS = {
            'default': '#f97316', 'pastel-blue': '#0284c7', 'pastel-indigo': '#6366f1',
            'pastel-green': '#16a34a', 'pastel-pink': '#db2777', 'custom': '#f97316'
        };

        let mealDate = new Date();
        let noticeDate = new Date();
        let albumPhotos = []; 
        let albumIdx = 0;
        let albumInterval = null;
        let musicPlaylist = [];
        let currentMusicIdx = 0;

        const saved = localStorage.getItem('happy_class_config_v3_47') || localStorage.getItem('happy_class_config_v3_46');
        if (saved) config = { ...config, ...JSON.parse(saved) };
        
        if (!config.schedule || config.schedule.length === 0) config.schedule = generateDefaultSchedule('09:00', config.lunchAfter);

        const audioChime = document.getElementById('chime-audio');
        const audioBgm = document.getElementById('bgm-audio');

        function init() {
            lucide.createIcons();
            applyBackground();
            applyTitleConfig();
            renderContent();
            updateTime();
            setInterval(updateTime, 1000);
            audioBgm.onended = () => playNext();
            if (config.isShuffle) {
                document.getElementById('music-shuffle-btn')?.classList.add('btn-active', 'opacity-100');
            }
        }

        function applyTitleConfig() {
            const titleEl = document.getElementById('left-panel-title');
            if (!titleEl) return;
            const c = config.titleConfig;
            titleEl.innerText = c.text || 'Happy Class';
            titleEl.style.fontFamily = c.font || '"Pretendard Variable", Pretendard';
            
            const sizeMap = { '4xl': '2.25rem', '5xl': '3rem', '6xl': '3.75rem', '7xl': '4.5rem', '8xl': '6rem', '9xl': '8rem' };
            const baseSize = sizeMap[c.size] || '3.75rem';
            titleEl.style.fontSize = window.innerWidth < 1024 ? `calc(${baseSize} * 0.7)` : baseSize;

            if (c.syncWithTheme) {
                titleEl.classList.add('dynamic-accent-text');
                titleEl.style.removeProperty('color');
            } else {
                titleEl.classList.remove('dynamic-accent-text');
                titleEl.style.color = c.color || '#1e293b';
            }
        }

        function toggleTitleColorPicker(isSync) {
            const picker = document.getElementById('title-color-input');
            if (picker) picker.disabled = isSync;
        }

        function updateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
            const dayIdx = now.getDay();
            
            document.getElementById('date-display').innerText = `${year}. ${month}. ${date}`;
            document.getElementById('day-display').innerText = dayNames[dayIdx];

            let h = now.getHours() % 12 || 12;
            const ampm = now.getHours() >= 12 ? 'Ïò§ÌõÑ' : 'Ïò§Ï†Ñ';
            document.getElementById('ampm-display').innerText = ampm;
            document.getElementById('time-display').innerText = `${String(h).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            document.getElementById('sec-display').innerText = String(now.getSeconds()).padStart(2,'0');

            updateStatus(now, dayIdx, `${month}-${date}`);
            updateDday(now);
        }

        function updateStatus(now, dayIdx, monthDay) {
            const currentTime = now.getHours() * 60 + now.getMinutes();
            let status = "Happy Ready";
            const HOLIDAYS = ['01-01', '03-01', '05-05', '06-06', '08-15', '10-03', '10-09', '12-25'];
            if (dayIdx === 0 || dayIdx === 6) status = "Ï£ºÎßê";
            else if (HOLIDAYS.includes(monthDay)) status = "Í≥µÌú¥Ïùº";
            else {
                const max = config.dailyPeriods[dayIdx] || 6;
                let found = false;
                for (const item of config.schedule) {
                    const match = item.name.match(/(\d)ÍµêÏãú/);
                    if (match && parseInt(match[1]) > max) continue;
                    const [sH, sM] = item.start.split(':').map(Number);
                    const [eH, eM] = item.end.split(':').map(Number);
                    if (currentTime >= (sH * 60 + sM) && currentTime < (eH * 60 + eM)) {
                        status = item.name; found = true; break;
                    }
                }
                if (!found && currentTime >= 480) status = "Î∞©Í≥ºÌõÑ";
            }
            const badge = document.getElementById('status-badge');
            if (badge) {
                badge.innerText = status;
                badge.className = (status === "Ï£ºÎßê" || status === "Í≥µÌú¥Ïùº") 
                    ? "glass inline-block px-6 py-3 lg:px-8 lg:py-4 rounded-2xl lg:rounded-3xl text-xl sm:text-2xl lg:text-3xl font-black shadow-xl border-white/50 text-red-500 mb-2"
                    : `glass inline-block px-6 py-3 lg:px-8 lg:py-4 rounded-2xl lg:rounded-3xl text-xl sm:text-2xl lg:text-3xl font-black shadow-xl border-white/50 mb-2 ${status.includes('ÍµêÏãú') ? 'dynamic-accent-text' : 'text-blue-600'}`;
            }
        }

        function updateDday(now) {
            const container = document.getElementById('dday-container');
            if(!container) return;
            container.innerHTML = '';
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            config.ddays.forEach(item => {
                const target = new Date(item.date);
                target.setHours(0,0,0,0);
                const diff = target - today;
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                if (days >= 0) {
                    const el = document.createElement('div');
                    el.className = "bg-white/60 backdrop-blur-sm px-3 py-1.5 sm:px-4 sm:py-2 rounded-xl sm:rounded-2xl border border-white/40 shadow-sm text-sm sm:text-lg font-bold text-slate-700 whitespace-nowrap";
                    el.innerText = days === 0 ? `Ïò§Îäò: ${item.text} üéà` : `${item.text} D-${days}`;
                    container.appendChild(el);
                }
            });
        }

        function startAlbum() {
            if (albumInterval) clearInterval(albumInterval);
            if (albumPhotos.length > 1) {
                const intervalMs = (config.albumIntervalSeconds || 5) * 1000;
                albumInterval = setInterval(() => {
                    const img = document.getElementById('album-image');
                    if (img) {
                        img.classList.add('fade-out');
                        setTimeout(() => {
                            albumIdx = (albumIdx + 1) % albumPhotos.length;
                            img.src = albumPhotos[albumIdx];
                            img.classList.remove('fade-out');
                        }, 1000); 
                    }
                }, intervalMs); 
            }
        }
        function stopAlbum() { if (albumInterval) clearInterval(albumInterval); }
        
        function handleAlbumFiles(input) {
            const files = Array.from(input.files).filter(f => f.type.startsWith('image/'));
            if (files.length === 0) return;
            albumPhotos = files.map(f => URL.createObjectURL(f));
            albumIdx = 0;
            document.getElementById('album-status-msg').innerText = `${files.length}Ïû• ÏÑ†ÌÉùÎê®`;
            if (config.viewMode === 'album') renderContent();
        }

        function toggleMusic() {
            if (musicPlaylist.length === 0) { openSettings(); return; }
            if (audioBgm.paused) {
                if (!audioBgm.src && musicPlaylist.length > 0) playTrack(0);
                else audioBgm.play();
                document.getElementById('music-icon').setAttribute('data-lucide', 'pause'); 
            } else {
                audioBgm.pause(); 
                document.getElementById('music-icon').setAttribute('data-lucide', 'play');
            }
            lucide.createIcons();
        }

        function playNext() {
            if (musicPlaylist.length === 0) return;
            currentMusicIdx = config.isShuffle ? Math.floor(Math.random() * musicPlaylist.length) : (currentMusicIdx + 1) % musicPlaylist.length;
            playTrack(currentMusicIdx);
        }

        function playPrev() {
            if (musicPlaylist.length === 0) return;
            currentMusicIdx = (currentMusicIdx - 1 + musicPlaylist.length) % musicPlaylist.length;
            playTrack(currentMusicIdx);
        }

        function toggleShuffle() {
            config.isShuffle = !config.isShuffle;
            const btn = document.getElementById('music-shuffle-btn');
            btn?.classList.toggle('btn-active', config.isShuffle);
            btn?.classList.toggle('opacity-40', !config.isShuffle);
            btn?.classList.toggle('opacity-100', config.isShuffle);
            saveToLocal();
        }

        function loadMusic(input) {
            const files = Array.from(input.files).filter(f => f.type.startsWith('audio/'));
            if (files.length === 0) return;
            musicPlaylist = files.map(f => ({ url: URL.createObjectURL(f), name: f.name }));
            currentMusicIdx = 0;
            playTrack(0);
            document.getElementById('album-status-msg').innerText = `${files.length}Í≥° ÏÑ†ÌÉùÎê®`;
        }

        function playTrack(idx) {
            if (!musicPlaylist[idx]) return;
            audioBgm.src = musicPlaylist[idx].url;
            audioBgm.play().catch(e => console.log(e));
            document.getElementById('music-icon').setAttribute('data-lucide', 'pause');
            lucide.createIcons();
        }

        function setVolume(val) { audioBgm.volume = val; }

        function setThemeColor(themeKey) {
            config.themeColor = themeKey;
            applyBackground();
            applyTitleConfig(); 
            updateColorSelectionUI();
            renderContent();
            saveToLocal();
        }

        function handleCustomColor(hex) {
            config.themeColor = 'custom'; config.customColor = hex;
            document.getElementById('color-custom').style.backgroundColor = hex;
            applyBackground(); applyTitleConfig(); updateColorSelectionUI();
            renderContent(); saveToLocal();
        }

        function updateColorSelectionUI() {
            document.querySelectorAll('.color-circle').forEach(el => el.classList.remove('selected'));
            const targetId = config.themeColor === 'custom' ? 'color-custom' : `color-${config.themeColor}`;
            document.getElementById(targetId)?.classList.add('selected');
        }

        function applyBackground() { 
            const bg = document.getElementById('bg-container');
            const themeValue = THEMES[config.themeColor] || THEMES['pastel-indigo'];
            bg.style.background = config.themeColor === 'default' ? THEMES['default'] : (config.themeColor === 'custom' ? config.customColor : themeValue);
            document.documentElement.style.setProperty('--accent-color', ACCENTS[config.themeColor] || ACCENTS['default']);
        }

        function toggleView(mode) { 
            config.viewMode = mode; 
            if (mode === 'album') startAlbum(); else stopAlbum();
            renderContent(); saveToLocal(); 
        }

        async function renderContent() {
            const container = document.getElementById('content-display-area');
            const titleEl = document.getElementById('right-title');
            const subtitleEl = document.getElementById('right-subtitle');
            const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const subtitleMap = { 'rules': 'CLASS RULES', 'notice': 'NOTICE BOARD', 'announcements': 'ANNOUNCEMENTS', 'meal': 'SCHOOL MEALS', 'album': 'CLASS ALBUM' };

            ['rules', 'notice', 'announcements', 'meal', 'album'].forEach(m => {
                const btn = document.getElementById(`btn-view-${m}`);
                if(btn) btn.className = (config.viewMode === m) 
                    ? "px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg font-black transition-all text-xs sm:text-sm dynamic-accent-bg text-white shadow-lg whitespace-nowrap" 
                    : "px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg font-bold transition-all text-xs sm:text-sm opacity-60 hover:opacity-100 whitespace-nowrap";
            });

            subtitleEl.innerText = subtitleMap[config.viewMode] || 'SMART DASHBOARD';

            if (config.viewMode === 'album') {
                titleEl.innerText = "Ïö∞Î¶¨ Î∞ò Ïï®Î≤î"; 
                if (albumPhotos.length === 0) {
                    container.innerHTML = `<div class="glass p-6 sm:p-10 rounded-[2rem] sm:rounded-[3rem] h-full flex flex-col items-center justify-center opacity-50"><i data-lucide="images" class="w-12 h-12 sm:w-20 sm:h-20 mb-4"></i><p class="text-sm sm:text-xl font-bold">ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p></div>`;
                } else {
                    container.innerHTML = `<div class="w-full h-full flex items-center justify-center overflow-hidden rounded-2xl sm:rounded-[3rem] glass"><img id="album-image" src="${albumPhotos[albumIdx]}" class="max-w-full max-h-full object-contain"></div>`;
                }
            } else if (config.viewMode === 'meal') {
                titleEl.innerText = "Ïò§ÎäòÏùò Í∏âÏãù"; 
                container.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div></div>`;
                const data = await getMealData();
                const formattedDate = `${mealDate.getFullYear()}.${String(mealDate.getMonth()+1).padStart(2,'0')}.${String(mealDate.getDate()).padStart(2,'0')} (${dayNames[mealDate.getDay()]})`;
                let mealHtml = `<div class="glass p-4 sm:p-8 rounded-[1.5rem] sm:rounded-[3rem] shadow-xl h-full flex flex-col border-white/50 animate-in fade-in">
                    <div class="flex items-center justify-between mb-4 sm:mb-8">
                        <button onclick="changeMealDate(-1)" class="p-2 hover:bg-white/30 rounded-full transition-all"><i data-lucide="chevron-left" class="w-5 h-5 sm:w-6 sm:h-6"></i></button>
                        <span class="text-lg sm:text-2xl font-black">${formattedDate}</span>
                        <button onclick="changeMealDate(1)" class="p-2 hover:bg-white/30 rounded-full transition-all"><i data-lucide="chevron-right" class="w-5 h-5 sm:w-6 sm:h-6"></i></button>
                    </div>`;
                if (data) {
                    const menus = data.DDISH_NM.split('<br/>').map(m => m.replace(/\([0-9.]+\)/g, '').trim());
                    mealHtml += `<div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 overflow-y-auto custom-scrollbar">
                        ${menus.map(m => `<div class="p-3 sm:p-4 bg-white/40 rounded-xl sm:rounded-2xl font-bold text-base sm:text-xl">${m}</div>`).join('')}
                    </div><div class="mt-4 text-right dynamic-accent-text font-bold text-xs sm:text-base">${data.CAL_INFO}</div>`;
                } else {
                    mealHtml += `<div class="flex-1 flex items-center justify-center opacity-40"><p class="font-bold">ÏãùÎã® Ï†ïÎ≥¥ ÏóÜÏùå</p></div>`;
                }
                mealHtml += `</div>`; container.innerHTML = mealHtml;
            } else if (config.viewMode === 'notice') {
                titleEl.innerText = "ÏïåÎ¶ºÏû•"; 
                const ymdKey = noticeDate.toISOString().split('T')[0];
                const formattedDate = `${noticeDate.getFullYear()}.${String(noticeDate.getMonth()+1).padStart(2,'0')}.${String(noticeDate.getDate()).padStart(2,'0')} (${dayNames[noticeDate.getDay()]})`;
                container.innerHTML = `<div class="glass p-4 sm:p-8 rounded-[1.5rem] sm:rounded-[3rem] shadow-xl h-full flex flex-col border-white/50 animate-in fade-in">
                    <div class="flex items-center justify-between mb-4 sm:mb-6">
                        <button onclick="changeNoticeDate(-1)" class="p-2 hover:bg-white/30 rounded-full transition-all"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                        <span class="text-lg sm:text-2xl font-black">${formattedDate}</span>
                        <button onclick="changeNoticeDate(1)" class="p-2 hover:bg-white/30 rounded-full transition-all"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                    </div><textarea id="notice-textarea" oninput="saveNoticeForDate(this.value)" placeholder="ÎÇ¥Ïö© ÏûÖÎ†•...">${config.notices[ymdKey] || ''}</textarea></div>`;
            } else {
                const type = config.viewMode === 'rules' ? 'rules' : 'announcements';
                titleEl.innerText = type === 'rules' ? "Ïö∞Î¶¨ Î∞ò ÏïΩÏÜç" : "Í≥µÏßÄÏÇ¨Ìï≠"; 
                let html = `<div class="space-y-2 sm:space-y-4">`;
                config[type].forEach((item, idx) => {
                    html += `<div class="glass p-4 sm:p-6 rounded-[1rem] sm:rounded-[2rem] flex items-center gap-3 sm:gap-6 group">
                        <span class="text-xl sm:text-4xl font-black opacity-10">${String(idx + 1).padStart(2, '0')}</span>
                        <div class="flex-1 min-w-0">
                            <input type="text" value="${item.title}" oninput="config['${type}'][${idx}].title = this.value; saveToLocal();" class="editable-input text-lg sm:text-2xl font-black truncate" placeholder="Ï†úÎ™©">
                            <input type="text" value="${item.desc}" oninput="config['${type}'][${idx}].desc = this.value; saveToLocal();" class="editable-input text-sm sm:text-lg font-bold opacity-70 truncate" placeholder="ÎÇ¥Ïö©">
                        </div>
                        <button onclick="config['${type}'].splice(${idx}, 1); renderContent(); saveToLocal();" class="p-2 text-red-400 opacity-0 group-hover:opacity-100 transition-all"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>`;
                });
                html += `<button onclick="config['${type}'].push({title:'', desc:''}); renderContent(); saveToLocal();" class="w-full py-3 sm:py-5 border-2 sm:border-4 border-dashed border-white/40 rounded-[1rem] sm:rounded-[2rem] text-slate-400 font-black hover:bg-white/20 transition-all text-sm sm:text-base">+ Ï∂îÍ∞ÄÌïòÍ∏∞</button></div>`;
                container.innerHTML = html;
            }
            lucide.createIcons();
        }

        function changeMealDate(days) { mealDate.setDate(mealDate.getDate() + days); renderContent(); }
        function changeNoticeDate(days) { noticeDate.setDate(noticeDate.getDate() + days); renderContent(); }
        function saveNoticeForDate(val) { const ymd = noticeDate.toISOString().split('T')[0]; config.notices[ymd] = val; saveToLocal(); showAutoSaveIndicator(); }

        async function fetchNEIS(endpoint, params) { const q = new URLSearchParams({ Type:'json', KEY:NEIS_API_KEY, ...params }); const r = await fetch(`${NEIS_BASE_URL}/${endpoint}?${q}`); return await r.json(); }
        async function getMealData() {
            if (!config.schoolInfo) return null;
            const ymd = mealDate.getFullYear() + String(mealDate.getMonth() + 1).padStart(2, '0') + String(mealDate.getDate()).padStart(2, '0');
            try { const data = await fetchNEIS('mealServiceDietInfo', { ATPT_OFCDC_SC_CODE: config.schoolInfo.atptCode, SD_SCHUL_CODE: config.schoolInfo.schulCode, MLSV_YMD: ymd }); return data.mealServiceDietInfo ? data.mealServiceDietInfo[1].row[0] : null; } 
            catch (e) { return null; }
        }

        async function searchSchoolInSettings() {
            const r = document.getElementById('region-select').value; const n = document.getElementById('school-name-search').value.trim(); if(!n) return;
            const res = document.getElementById('school-search-results'); res.innerHTML='<div class="text-xs p-2">Í≤ÄÏÉâ Ï§ë...</div>';
            try { 
                const d = await fetchNEIS('schoolInfo', { ATPT_OFCDC_SC_CODE:r, SCHUL_NM:n });
                if(d.schoolInfo) {
                    res.innerHTML = d.schoolInfo[1].row.map(s => `
                        <button onclick="selectSchool('${s.ATPT_OFCDC_SC_CODE}', '${s.SD_SCHUL_CODE}', '${s.SCHUL_NM}')" class="w-full text-left p-2 border rounded-xl hover:bg-blue-50 mb-1">
                            <div class="text-xs font-bold">${s.SCHUL_NM}</div>
                        </button>`).join('');
                } else res.innerHTML = '<div class="text-xs p-2">Í≤∞Í≥º ÏóÜÏùå</div>';
            } catch(e){ res.innerHTML = '<div class="text-xs p-2 text-red-500">Ïò§Î•ò</div>'; }
        }
        function selectSchool(atpt, schul, name) { config.tempSchool = { atptCode:atpt, schulCode:schul, schulNm:name }; document.getElementById('selected-school-info').innerText=`‚úÖ ÏÑ†ÌÉùÎê®: ${name}`; }

        function generateDefaultSchedule(startTime, lunchAfter = 4) {
            const [h, m] = startTime.split(':').map(Number); let current = h * 60 + m;
            const format = (min) => `${String(Math.floor(min/60)).padStart(2,'0')}:${String(min%60).padStart(2,'0')}`;
            let sch = [{ name: 'ÏïÑÏπ®ÏûêÏäµ', start: '08:30', end: format(current) }];
            for(let i=1; i<=6; i++) {
                sch.push({ name: `${i}ÍµêÏãú`, start: format(current), end: format(current+40) }); current += 40;
                if (i == lunchAfter) { sch.push({ name: 'Ï†êÏã¨ ÏãúÍ∞Ñ', start: format(current), end: format(current+50) }); current += 50; } 
                else if (i < 6) { sch.push({ name: 'Ïâ¨Îäî ÏãúÍ∞Ñ', start: format(current), end: format(current+10) }); current += 10; }
            }
            return sch;
        }

        function openSettings() {
            document.getElementById('settings-modal').style.display = 'flex'; 
            document.getElementById('album-interval-input').value = config.albumIntervalSeconds || 5;
            document.getElementById('title-text-input').value = config.titleConfig.text || 'Happy Class';
            document.getElementById('title-font-input').value = config.titleConfig.font || '"Pretendard Variable", Pretendard';
            document.getElementById('title-size-input').value = config.titleConfig.size || '6xl';
            document.getElementById('title-color-input').value = config.titleConfig.color || '#6366f1';
            document.getElementById('title-sync-checkbox').checked = config.titleConfig.syncWithTheme;
            toggleTitleColorPicker(config.titleConfig.syncWithTheme);
            const de = document.getElementById('dday-editor'); de.innerHTML = '';
            config.ddays.forEach(d => addRow('dday-editor', d.text, d.date)); 
            document.getElementById('selected-school-info').innerText = config.schoolInfo ? `‚úÖ ÌòÑÏû¨: ${config.schoolInfo.schulNm}` : "";
            updateColorSelectionUI(); lucide.createIcons();
        }

        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
        function handleOutsideClick(e) { if (e.target.id === 'settings-modal') closeSettings(); }

        function saveSettings() {
            config.albumIntervalSeconds = parseInt(document.getElementById('album-interval-input').value) || 5;
            config.titleConfig = {
                text: document.getElementById('title-text-input').value,
                font: document.getElementById('title-font-input').value,
                size: document.getElementById('title-size-input').value,
                color: document.getElementById('title-color-input').value,
                syncWithTheme: document.getElementById('title-sync-checkbox').checked
            };
            if(config.tempSchool) { config.schoolInfo = config.tempSchool; delete config.tempSchool; }
            const dt = document.querySelectorAll('.dday-title-in'); const dd = document.querySelectorAll('.dday-date-in'); config.ddays = [];
            dt.forEach((t, i) => { if (t.value.trim() && dd[i].value) config.ddays.push({ text: t.value, date: dd[i].value }); });
            saveToLocal(); applyBackground(); applyTitleConfig(); renderContent(); updateTime(); 
            if (config.viewMode === 'album') startAlbum();
            closeSettings(); showAutoSaveIndicator();
        }

        function saveToLocal() { localStorage.setItem('happy_class_config_v3_47', JSON.stringify(config)); }
        function showAutoSaveIndicator() { const i = document.getElementById('auto-save-indicator'); if(i) { i.style.opacity = '1'; setTimeout(() => i.style.opacity = '0', 1000); } }

        function addRow(id, t="", d="") {
            const e = document.getElementById(id); const r = document.createElement('div'); r.className = "flex gap-2 items-center mb-2";
            r.innerHTML = `<input type="text" value="${t}" class="dday-title-in flex-1 p-2 border rounded-xl text-sm font-bold" placeholder="ÏùºÏ†ï Î™Ö"><input type="date" value="${d}" class="dday-date-in p-2 border rounded-xl text-sm font-bold"><button onclick="this.parentElement.remove()" class="p-2 text-red-400"><i data-lucide="trash-2" class="w-5 h-5"></i></button>`;
            e.appendChild(r); lucide.createIcons();
        }

        window.addEventListener('resize', () => { applyTitleConfig(); });
        window.onload = init;
    </script>
</body>
</html>
